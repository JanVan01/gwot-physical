{% extends "base/frontend.html" %}

{% block resources%}
<link href="//cdnjs.cloudflare.com/ajax/libs/c3/0.1.29/c3.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/c3/0.1.29/c3.js"></script>
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
{% endblock resources%}

{% block navigation %}
<li class="active"><a href="/">Home</a></li>
<li><a href="/data">Data</a></li>
<li><a href="/config">Config</a></li>
<li><a href="/about">About</a></li>
{% endblock navigation %}

{% block content %}
<div class="container-fluid overview">
  <div class="row" id="drop">
    <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8">
		<h2>Data overview for sensor <em id="title_sensor"></em></h2>
    </div>
    <div class="dropdown col-xs-12 col-sm-12 col-md-4 col-lg-4">
      <button class="btn btn-primary dropdown-toggle " type="button" data-toggle="dropdown">Select the sensor <span class="caret"></span></button>
      <ul id="sensor_types" class="dropdown-menu">
        {% for key, value in data.items() %}
        <li id="{{key}}" class="sensor_li"><a href="#">{{ value.sensor_type }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div id="table_div" class="row table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th></th>
          <th>Hourly</th>
          <th>Daily</th>
          <th>Monthly</th>
          <th>Yearly</th>
          <th>Accumulated</th>
        </tr>
      </thead>
      <tbody>
        <tr id="min_values">
        </tr>
        <tr id="avg_values">
        </tr>
        <tr id="max_values">
        </tr>
      </tbody>
    </table>
  </div>
  <div class="row" id="valueMap">
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
      <p id="value_content"></p>
    </div>
    <div id="mapid" class="col-xs-12 col-sm-12 col-md-6 col-lg-6" style="height: 350px;">
    </div>
  </div>
</div>



<script>
var newdata = {{ data | safe}};
var current_id = 1;
window.onload = function() {
  set_values();
  $('.sensor_li').each(function(){
    $(this).click(function(e){
      current_id = $(this).attr('id');
      set_values();
      e.preventDefault();
    });
  });
};
createmap();

function set_values () {
  $("#value_content").text("Last Measurement: " + newdata[current_id].last.toString());
  $("#title_sensor").text(newdata[current_id].sensor_type.toString());
  $("#min_values").html("<td>Minimum</td>"+
    "<td>" + newdata[current_id].daily.min + "</td>"
   +"<td>" + newdata[current_id].hourly.min + "</td>"
   +"<td>" + newdata[current_id].monthly.min + "</td>"
   +"<td>" + newdata[current_id].yearly.min + "</td>"
   +"<td>" + newdata[current_id].accum.min + "</td>");
  $("#avg_values").html("<td>Average</td>"+
    "<td>" + newdata[current_id].daily.avg + "</td>"
   +"<td>" + newdata[current_id].hourly.avg + "</td>"
   +"<td>" + newdata[current_id].monthly.avg + "</td>"
   +"<td>" + newdata[current_id].yearly.avg + "</td>"
   +"<td>" + newdata[current_id].accum.avg + "</td>");
  $("#max_values").html("<td>Maximum</td>"+
    "<td>" + newdata[current_id].daily.max + "</td>"
   +"<td>" + newdata[current_id].hourly.max + "</td>"
   +"<td>" + newdata[current_id].monthly.max + "</td>"
   +"<td>" + newdata[current_id].yearly.max + "</td>"
   +"<td>" + newdata[current_id].accum.max + "</td>");
}

function createmap() {
  var mymap = L.map('mapid').setView([newdata[current_id].lon , newdata[current_id].lat], 18);
  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
    maxZoom: 18,
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
    'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    id: 'mapbox.streets'
  }).addTo(mymap);
  L.marker([newdata[current_id].lon , newdata[current_id].lat]).addTo(mymap)
  .bindPopup("Physical Smart Thing!");
  mymap.on('click', onMapClick);
}
</script>

{% endblock content %}